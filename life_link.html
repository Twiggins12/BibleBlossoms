<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Bible Blossoms | Life Link</title>

  <link rel="icon" type="image/png" href="favicon.png">

  <!-- Google Font -->
  <link href="https://fonts.googleapis.com/css2?family=Lobster&display=swap" rel="stylesheet">

  <!-- Shared Styles -->
  <link rel="stylesheet" href="css/styles.css">

  <!-- Life Link Only Styles -->
  <link rel="stylesheet" href="css/life_link.css">

  <!-- PapaParse -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
</head>
<body>
<header id="top">
  <h1>Life Link</h1>
  <h2>Bible Topical Reference</h2>
  <h3>World English Bible (WEB)</h3>
</header>
  <div class="page-content">
<div id="domain-top-left">
  <a href="index.html">BibleBlossoms</a>
</div>

<!-- Section Containers -->
<div id="sections-container">
  <div class="section-container"><div class="section-heading">Father, Son, Holy Spirit</div><div class="dropdown-column"><select class="mainTopicSelect"><option value="">Select Main Topic</option></select><select class="subTopicSelect"><option value="">Select Sub-Topic</option></select><select class="bookSelect"><option value="">Select Book</option></select><div class="verseText"></div></div></div>
  <div class="section-container"><div class="section-heading">Creation, Earth, Animals</div><div class="dropdown-column"><select class="mainTopicSelect"><option value="">Select Main Topic</option></select><select class="subTopicSelect"><option value="">Select Sub-Topic</option></select><select class="bookSelect"><option value="">Select Book</option></select><div class="verseText"></div></div></div>
  <div class="section-container"><div class="section-heading">History, Laws, Sin</div><div class="dropdown-column"><select class="mainTopicSelect"><option value="">Select Main Topic</option></select><select class="subTopicSelect"><option value="">Select Sub-Topic</option></select><select class="bookSelect"><option value="">Select Book</option></select><div class="verseText"></div></div></div>
  <div class="section-container"><div class="section-heading">People, Culture, Objects</div><div class="dropdown-column"><select class="mainTopicSelect"><option value="">Select Main Topic</option></select><select class="subTopicSelect"><option value="">Select Sub-Topic</option></select><select class="bookSelect"><option value="">Select Book</option></select><div class="verseText"></div></div></div>
  <div class="section-container"><div class="section-heading">Mind, Body, Spirit</div><div class="dropdown-column"><select class="mainTopicSelect"><option value="">Select Main Topic</option></select><select class="subTopicSelect"><option value="">Select Sub-Topic</option></select><select class="bookSelect"><option value="">Select Book</option></select><div class="verseText"></div></div></div>
  <div class="section-container"><div class="section-heading">Cities, Rivers, Other Locations, Travels</div><div class="dropdown-column"><select class="mainTopicSelect"><option value="">Select Main Topic</option></select><select class="subTopicSelect"><option value="">Select Sub-Topic</option></select><select class="bookSelect"><option value="">Select Book</option></select><div class="verseText"></div></div></div>
  <div class="section-container"><div class="section-heading">Spiritual Beings, Miracles</div><div class="dropdown-column"><select class="mainTopicSelect"><option value="">Select Main Topic</option></select><select class="subTopicSelect"><option value="">Select Sub-Topic</option></select><select class="bookSelect"><option value="">Select Book</option></select><div class="verseText"></div></div></div>
  <div class="section-container"><div class="section-heading">Visions, Prophecies, End Times</div><div class="dropdown-column"><select class="mainTopicSelect"><option value="">Select Main Topic</option></select><select class="subTopicSelect"><option value="">Select Sub-Topic</option></select><select class="bookSelect"><option value="">Select Book</option></select><div class="verseText"></div></div></div>
  <div class="section-container"><div class="section-heading">Wisdom, Instructions</div><div class="dropdown-column"><select class="mainTopicSelect"><option value="">Select Main Topic</option></select><select class="subTopicSelect"><option value="">Select Sub-Topic</option></select><select class="bookSelect"><option value="">Select Book</option></select><div class="verseText"></div></div></div>
  <div class="section-container"><div class="section-heading">Promises, Covenants</div><div class="dropdown-column"><select class="mainTopicSelect"><option value="">Select Main Topic</option></select><select class="subTopicSelect"><option value="">Select Sub-Topic</option></select><select class="bookSelect"><option value="">Select Book</option></select><div class="verseText"></div></div></div>
</div>

<div id="loading">Loading verses...</div>
<div style="text-align:center; margin-top:40px;">
</div>

<script>
  // Each section can point to its own CSV file
 const csvFiles = [
  'data/sections/section1_Father.csv',
  'data/sections/section2_Creation.csv',
  'data/sections/section3_History.csv',
  'data/sections/section4_People.csv',
  'data/sections/section5_Mind.csv',
  'data/sections/section6_Cities.csv',
  'data/sections/section7_SpiritualBeings.csv',
  'data/sections/section8_Visions.csv',
  'data/sections/section9_Wisdom.csv',
  'data/sections/section10_Promises.csv'
];

  const sectionContainers = document.querySelectorAll('.section-container');

  sectionContainers.forEach((section, index) => {
    const mainTopicSelect = section.querySelector('.mainTopicSelect');
    const subTopicSelect = section.querySelector('.subTopicSelect');
    const bookSelect = section.querySelector('.bookSelect');
    const verseTextDiv = section.querySelector('.verseText');

    let masterRows = [];

    async function loadMasterCSV() {
      try {
        const res = await fetch(csvFiles[index]);
        const csvText = await res.text();
        const parsed = Papa.parse(csvText, { header: true, skipEmptyLines: true });
        masterRows = parsed.data.map(row => ({
          Section: row.Section.trim(),
          MainTopic: row.MainTopic.trim(),
          SubTopic: row.SubTopic.trim(),
          Book: row.Book.trim(),
          Chapter: parseInt(row.Chapter),
          Verse: parseInt(row.Verse)
        }));

        const mainTopics = [...new Set(masterRows.map(r => r.MainTopic))];
        mainTopics.forEach(topic => {
          const opt = document.createElement('option');
          opt.value = topic;
          opt.text = topic;
          mainTopicSelect.appendChild(opt);
        });
      } catch(err) {
        console.error('Error loading CSV:', err);
      }
    }

    mainTopicSelect.addEventListener('change', () => {
      subTopicSelect.innerHTML = '<option value="">Select Sub-Topic</option>';
      bookSelect.innerHTML = '<option value="">Select Book</option>';
      verseTextDiv.innerHTML = '';
      const selectedTopic = mainTopicSelect.value;
      if(!selectedTopic) return;
      const subTopics = [...new Set(masterRows.filter(r => r.MainTopic === selectedTopic).map(r => r.SubTopic))];
      subTopics.forEach(sub => {
        const opt = document.createElement('option');
        opt.value = sub;
        opt.text = sub;
        subTopicSelect.appendChild(opt);
      });
    });

    subTopicSelect.addEventListener('change', () => {
      bookSelect.innerHTML = '<option value="">Select Book</option>';
      verseTextDiv.innerHTML = '';
      const selectedTopic = mainTopicSelect.value;
      const selectedSub = subTopicSelect.value;
      if(!selectedTopic || !selectedSub) return;
      const books = [...new Set(masterRows.filter(r => r.MainTopic === selectedTopic && r.SubTopic === selectedSub).map(r => r.Book))];
      books.forEach(book => {
        const opt = document.createElement('option');
        opt.value = book;
        opt.text = book;
        bookSelect.appendChild(opt);
      });
    });

    bookSelect.addEventListener('change', () => {
      verseTextDiv.innerHTML = '';
      const selectedTopic = mainTopicSelect.value;
      const selectedSub = subTopicSelect.value;
      const selectedBook = bookSelect.value;
      if(!selectedTopic || !selectedSub || !selectedBook) return;

      const filteredRows = masterRows.filter(r =>
        r.MainTopic === selectedTopic &&
        r.SubTopic === selectedSub &&
        r.Book === selectedBook
      );

      let currentChapter = null;
      const table = document.createElement('table');
      table.className = 'verse-table';

      async function displayVerses() {
        for(const row of filteredRows) {
          const reference = `${row.Book} ${row.Chapter}:${row.Verse}`;
          try {
            const res = await fetch(`https://bible-api.com/${encodeURIComponent(reference)}`);
            const d = await res.json();
            if(!d.text) continue;

            if(currentChapter !== row.Chapter) {
              currentChapter = row.Chapter;
              const trChapter = document.createElement('tr');
              trChapter.className = 'chapter-row';
              const tdChapter = document.createElement('td');
              tdChapter.colSpan = 2;
              tdChapter.innerText = `Chapter ${currentChapter}`;
              trChapter.appendChild(tdChapter);
              table.appendChild(trChapter);
            }

            const trVerse = document.createElement('tr');
            trVerse.className = 'verse-row';
            const tdNumber = document.createElement('td');
            tdNumber.className = 'verse-number';
            tdNumber.innerText = row.Verse;
            const tdText = document.createElement('td');
            tdText.className = 'verse-text';
            tdText.innerText = d.text;
            trVerse.appendChild(tdNumber);
            trVerse.appendChild(tdText);
            table.appendChild(trVerse);

          } catch(err) {
            console.error(`Error fetching ${reference}:`, err);
          }
        }
        verseTextDiv.appendChild(table);
      }

      displayVerses();
    });

    loadMasterCSV();
  });
</script>
  </div>
  
<footer class="site-footer">
  <a href="index.html">Home</a>
  <a href="life_link.html">Life Link</a>
  <a href="puzzles.html">WORDokus</a>
  <a href="mazes.html">Mazes</a>
  <a href="coloring_pages.html">Coloring Pages</a>
  <a href="about.html">About</a>
  <a href="#top">Top</a>
</footer>

</body>
</html>
